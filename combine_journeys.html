<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kombinera GPS-resor (JSON)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; background: #f4f8fb; color: #222; margin: 0; padding: 0; }
    .container { max-width: 480px; margin: 32px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,.08); padding: 24px; }
    h2 { margin-top: 0; }
    input[type=file] { margin-bottom: 16px; }
    button { padding: 10px 18px; background: #2176ae; color: #fff; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    #result { margin-top: 18px; font-size: 15px; color: #2176ae; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Kombinera GPS-resor (JSON)</h2>
    <input type="file" id="fileInput" multiple accept="application/json">
    <button id="combineBtn" disabled>Kombinera och ladda ner</button>
    <div id="result"></div>
  </div>
  <script>
    const fileInput = document.getElementById('fileInput');
    const combineBtn = document.getElementById('combineBtn');
    const resultDiv = document.getElementById('result');
    let loadedJourneys = [];

    fileInput.addEventListener('change', async function() {
      loadedJourneys = [];
      resultDiv.textContent = '';
      if (fileInput.files.length < 2) {
        combineBtn.disabled = true;
        resultDiv.textContent = 'Välj minst två JSON-filer.';
        return;
      }
      combineBtn.disabled = false;
      // Read all files
      for (const file of fileInput.files) {
        try {
          const text = await file.text();
          const data = JSON.parse(text);
          if (Array.isArray(data)) {
            loadedJourneys.push(...data);
          } else if (typeof data === 'object') {
            loadedJourneys.push(data);
          }
        } catch {
          resultDiv.textContent = `Fel vid läsning av ${file.name}`;
          combineBtn.disabled = true;
          return;
        }
      }
      resultDiv.textContent = `${loadedJourneys.length} resor laddade.`;
    });

    combineBtn.addEventListener('click', function() {
      if (loadedJourneys.length < 2) return;
      const blob = new Blob([JSON.stringify(loadedJourneys, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'combined_journeys.json';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); }, 500);
      resultDiv.textContent = `Kombinerad fil nedladdad (${loadedJourneys.length} resor).`;
    });
  </script>
</body>
</html>
